# SPDX-FileCopyrightText: 2023-2025 Tampere region
#
# SPDX-License-Identifier: LGPL-2.1-or-later

min_version = "2025.5.1"

[settings]
idiomatic_version_file_enable_tools = ["terraform"]

[tools]
java = "temurin-21"
node = { version = "22", postinstall = "corepack enable" }

[env]
NODE_OPTIONS = "--max-old-space-size=4096"

[vars]
municipality = "{% if mise_env %}{{ mise_env | first }}{% else %}tampere{% endif %}"

[tasks.start]
depends = ["trevaka-frontend", "trevaka-apigw", "trevaka-service"]

[tasks.trevaka-frontend]
dir = "evaka/frontend"
run = "yarn && yarn clean && yarn dev"
env.EVAKA_CUSTOMIZATIONS = "{{ vars.municipality }}"

[tasks.trevaka-apigw]
dir = "evaka/apigw"
run = "yarn && yarn clean && yarn dev"
env.EVAKA_TITANIA_USERNAME = "titania"
env.EVAKA_TITANIA_PASSWORD = "titania"
env.AD_SAML_EXTERNAL_ID_PREFIX = "tampere-ad"

[tasks.trevaka-service]
dir = "service"
run = "./gradlew bootRun"
run_windows = "gradlew.bat bootRun"
env.SPRING_PROFILES_INCLUDE = "local,trevaka-local"
env.SPRING_PROFILES_ACTIVE = "{{ vars.municipality }}_evaka"
